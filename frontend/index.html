<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="./favicon.png">
  <title>Massi</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Sansation:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">

  <link href="/src/styles.css" rel="stylesheet">
</head>
<body class="font-primary">
  <div
    x-data="{ openChat: false, expandChat: false }"
    class="fixed w-dvw h-dvh top-0 left-0"
  >
    <div class="relative w-full h-full flex items-end justify-end">
      <!-- botón para abrir el contenedor del chat -->
      <button @click="openChat = !openChat;"
        class="w-[64px] aspect-square flex items-center justify-center rounded-full bg-primary border-2 border-secondary hover:cursor-pointer hover:scale-105 transition-all duration-300 ease-out hover:shadow active:scale-95 relative me-8 mb-8"
        :class="openChat ? 'opacity-0' : ''" id="openChatButton">
        <img src="./favicon.png">
        <span class="absolute top-[-10%] right-[-10%] bg-secondary rounded-full px-2 py-1 text-white opacity-0"
          id="botNotify">
          <i class="fa-solid fa-bell"></i>
        </span>
      </button>
      
      <!-- contenedor del chat -->
      <div
        x-show="openChat"
        x-transition:enter="transition transform ease-out duration-100"
        x-transition:enter-start="opacity-0 translate-y-4 translate-x-4"
        x-transition:enter-end="opacity-100 translate-y-0 translate-x-0"
        x-transition:leave="transition transform ease-in duration-200"
        x-transition:leave-start="opacity-100 translate-y-0 translate-x-0"
        x-transition:leave-end="opacity-0 translate-y-4 translate-x-4"
        class="w-max absolute right-8 bottom-8 shadow-2xl rounded-lg transition-all duration-300"
        :class="expandChat ? '!right-[50%] !bottom-[50%] !translate-x-[50%] !translate-y-[50%]' : ''"
      >
        <div class="w-full bg-secondary rounded-t-lg p-3 flex justify-between items-center">
          <div class="flex gap-2">
            <span
              class="overflow-hidden rounded-full flex items-center justify-center bg-primary w-[40px] h-[40px] border-2 border-secondary text-secondary">
              <img class="w-full h-full object-cover rounded-full" src="./favicon.png">
            </span>
            <div class="flex flex-col items-start">
              <span class="text-white font-semibold text-lg">Massi</span>
              <span class="text-xs transition-all duration-300 select-none" id="status"></span>
            </div>
          </div>

          <div class="flex gap-2">
            <div x-data="{ openMenu: false }" class="relative">
              <button
                @click="openMenu = !openMenu"
                class="hover:cursor-pointer w-[32px] h-[32px] flex items-center justify-center text-white transition-all duration-100 hover:bg-white/25 rounded-full font-semibold text-xl hover:scale-105 active:scale-95"
                type="button"
              >
                <i class="fa-solid fa-ellipsis-vertical"></i>
              </button>
              <div
                x-show="openMenu"
                x-transition:enter="transition transform ease-out duration-100"
                x-transition:enter-start="opacity-0 -translate-y-4 translate-x-4"
                x-transition:enter-end="opacity-100 translate-y-0 translate-x-0"
                x-transition:leave="transition transform ease-in duration-200"
                x-transition:leave-start="opacity-100 translate-y-0 translate-x-0"
                x-transition:leave-end="opacity-0 -translate-y-4 translate-x-4"
                @click.outside="openMenu = false"
                class="w-max bg-white border-2 border-secondary rounded-lg p-2 absolute right-full top-full z-50"
              >
                <div
                  x-data="{ openReport: false }"
                  @click.outside="openReport = false"
                  class="relative"
                >
                  <button
                    @click="openReport = !openReport"
                    class="rounded hover:bg-secondary/20 px-4 py-2 flex items-center justify-center gap-2 text-secondary hover:cursor-pointer transition-all duration-300"
                    :class="openReport ? 'bg-secondary/20' : ''"
                    type="button"
                  >
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    <span class="font-semibold">Reportar un problema</span>
                  </button>
                </div>
                <hr class="border-secondary/20 my-2">
                <div x-data="{ openConfirm: false }" class="relative">
                  <button
                    @click="openConfirm = !openConfirm"
                    class="rounded hover:bg-red-400/20 px-4 py-2 flex items-center justify-center gap-2 text-red-400 hover:cursor-pointer transition-all duration-300"
                    :class="openConfirm ? 'bg-red-400/20' : ''"
                    type="button">
                    <i class="fa-solid fa-trash-alt"></i>
                    <span class="font-semibold">Eliminar conversación</span>
                  </button>
                  <div
                    x-show="openConfirm"
                    x-transition:enter="transition transform ease-out duration-100"
                    x-transition:enter-start="opacity-0 scale-75"
                    x-transition:enter-end="opacity-100 scale-100"
                    x-transition:leave="transition transform ease-in duration-200"
                    x-transition:leave-start="opacity-100 scale-100"
                    x-transition:leave-end="opacity-0 scale-75"
                    class="bg-black/20 fixed w-dvw h-dvh right-[50%] bottom-[50%] translate-x-[50%] translate-y-[50%] z-50 flex items-center justify-center"
                  >
                    <div class="flex flex-col gap-6 items-center bg-primary border-2 border-secondary shadow-2xl rounded-lg px-8 py-6">
                      <div class="text-center font-semibold text-secondary text-xl">
                        <p>
                          ¿Deseas eliminar tu conversación actual con Massi?
                        </p>
                      </div>
                      <div class="flex gap-8">
                        <button @click="openConfirm = false" class="px-6 py-2 rounded-lg border-2 border-secondary bg-secondary text-primary hover:cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300 flex gap-2 items-center justify-center" id="deleteChat" type="button">
                          <i class="fa-solid fa-circle-check"></i>
                          <span class="font-semibold uppercase">Confirmar</span>
                        </button>
                        <button @click="openConfirm = false" class="px-6 py-2 rounded-lg border-2 border-secondary text-secondary hover:cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300 flex gap-2 items-center justify-center" type="button">
                          <i class="fa-solid fa-circle-xmark"></i>
                          <span class="font-semibold uppercase">Cancelar</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <button @click="expandChat = !expandChat"
              class="hover:cursor-pointer w-[32px] h-[32px] flex items-center justify-center text-white transition-all duration-100 hover:bg-white/25 rounded-full font-semibold text-xl hover:scale-105 active:scale-95"
              type="button">
              <i class="fa-solid" :class="expandChat ? 'fa-minus' : 'fa-expand'"></i>
            </button>
            <button @click="openChat = false"
              class="hover:cursor-pointer w-[32px] h-[32px] flex items-center justify-center text-white transition-all duration-100 hover:bg-white/25 rounded-full font-semibold text-xl hover:scale-105 active:scale-95"
              type="button" id="deleteChat">
              <i class="fa-solid fa-times"></i>
            </button>
          </div>
        </div>

        <img
          class="absolute z-1 scale-120 opacity-25 top-[50%] left-[50%] translate-y-[-50%] translate-x-[-50%] transition-all duration-300 pointer-events-none select-none"
          :class="expandChat ? '!scale-150' : ''"
          src="./images/mass_logo.webp"
        >
        
        <div id="chatbox" class="w-[20rem] h-[20rem] p-4 bg-primary border-x-2 border-secondary transition-all duration-300 flex flex-col gap-3 overflow-y-auto scrollbar-primary relative" :class="expandChat ? '!h-[60dvh] !w-[80dvw]' : ''">
          <template id="botChatbox">
            <div class="flex flex-col justify-end gap-1 relative z-10 chatBoxMessage">
              <div class="flex justify-start gap-2">
                <span
                  class="overflow-hidden rounded-full flex items-center justify-center bg-primary w-[40px] h-[40px] border-2 border-secondary text-secondary">
                  <img class="w-full h-full object-cover rounded-full" src="./favicon.png">
                </span>
                <p class="max-w-[75%] whitespace-normal wrap-anywhere break-normal bg-gray-100 text-secondary border-2 border-secondary p-2 rounded-e-xl rounded-b-xl text-md botMessage"></p>
              </div>
            </div>
          </template>
          
          <template id="userChatbox">
            <div class="flex flex-col justify-end gap-1 relative z-10 chatBoxMessage">
              <div class="flex justify-end gap-2">
                <p
                  class="max-w-[75%] whitespace-normal wrap-anywhere break-normal bg-gray-100 text-secondary border-2 border-secondary p-2 rounded-s-xl rounded-b-xl text-md userMessage">
                </p>
                <span
                  class="overflow-hidden rounded-full flex items-center justify-center bg-primary w-[40px] h-[40px] border-2 border-secondary text-secondary">
                  <i class="fa-solid fa-user"></i>
                </span>
              </div>
            </div>
          </template>

          <div class="max-w-[90%] flex flex-col gap-2 items-center justify-center transition-all duration-300 absolute self-center pb-4" id="suggestions">
            <h2 class="my-2 text-2xl text-secondary font-semibold text-center flex flex-col items-center justify-center gap-2">
              <span class="bg-secondary text-primary px-4 py-2 rounded-lg">!Soy Massi!</span>¿Con qué puedo ayudarte?
            </h2>
            <button class="suggestionMessage hover:cursor-pointer hover:scale-105 hover:shadow-2xl transition-all duration-300 bg-gray-100 z-25 flex gap-2 items-center justify-center border-2 border-secondary px-4 py-2 rounded-lg text-secondary" type="button">
              <i class="fa-solid fa-list-check"></i>
              <span class="font-semibold">Quisiera conocer la lista de precios de sus productos.</span>
            </button>
            <button class="suggestionMessage hover:cursor-pointer hover:scale-105 hover:shadow-2xl transition-all duration-300 bg-gray-100 z-25 flex gap-2 items-center justify-center border-2 border-secondary px-4 py-2 rounded-lg text-secondary" value="Brindame más información sobre Tiendas Mass." type="button">
              <i class="fa-solid fa-info-circle"></i>
              <span class="font-semibold">Brindame más información sobre Tiendas Mass.</span>
            </button>
            <button
              class="suggestionMessage hover:cursor-pointer hover:scale-105 hover:shadow-2xl transition-all duration-300 bg-gray-100 z-25 flex gap-2 items-center justify-center border-2 border-secondary px-4 py-2 rounded-lg text-secondary"
              type="button">
              <i class="fa-solid fa-right-left"></i>
              <span class="font-semibold">¿Tiendas Mass tiene una política para devoluciones?</span>
            </button>
          </div>
        </div>
        
        <div class="w-full flex gap-2 items-center justify-between p-3 bg-secondary rounded-b-lg">
          <textarea
            class="scrollbar-secondary bg-gray-100 border-2 border-secondary flex-1 px-4 py-2 text-md resize-none rounded-lg w-full focus:outline-0 caret-secondary text-secondary"
            name="messageInput" id="messageInput" rows="1" placeholder="Escribe tu mensaje..."></textarea>
          <button
            class="w-[40px] h-[40px] flex items-center justify-center text-secondary text-xl bg-white border-2 border-secondary rounded-full hover:cursor-pointer hover:scale-105 transition-all duration-100 active:scale-95"
            type="submit" id="sendButton">
            <i class="fa-solid fa-arrow-up"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./src/alpinejs.js"></script>
  <script type="module" src="./src/chat.js"></script>
</body>
</html>